# WeKnora 宝塔面板部署指南

本指南详细介绍如何在宝塔面板的网站目录下部署 WeKnora 项目，适用于二次开发后的测试和生产环境部署。

## 📋 目录

- [环境要求](#环境要求)
- [部署架构说明](#部署架构说明)
- [部署步骤](#部署步骤)
  - [1. 准备工作](#1-准备工作)
  - [2. 安装依赖服务](#2-安装依赖服务)
  - [3. 配置数据库](#3-配置数据库)
  - [4. 部署后端服务](#4-部署后端服务)
  - [5. 部署文档解析服务](#5-部署文档解析服务)
  - [6. 部署前端](#6-部署前端)
  - [7. 配置Nginx反向代理](#7-配置nginx反向代理)
- [服务管理](#服务管理)
- [常见问题](#常见问题)

---

## 环境要求

### 服务器配置推荐
- **CPU**: 4核及以上
- **内存**: 8GB及以上
- **硬盘**: 100GB及以上（SSD推荐）
- **操作系统**: CentOS 7/8, Ubuntu 18.04/20.04/22.04
- **宝塔面板**: 7.x 或更高版本

### 必需软件
- **宝塔面板**: 已安装并正常运行
- **Go**: 1.24.0 或更高版本
- **Python**: 3.8 或更高版本
- **Node.js**: 16.x 或更高版本
- **PostgreSQL**: 13 或更高版本（推荐使用 ParadeDB）
- **Redis**: 7.0 或更高版本
- **MinIO**: 用于对象存储（或使用本地存储）
- **Nginx**: 1.18 或更高版本

---

## 部署架构说明

WeKnora 项目由以下组件构成：

```
┌─────────────────────────────────────────────────┐
│              Nginx (宝塔面板管理)                │
│         端口: 80/443 (域名: your-domain.com)     │
└────────────────┬────────────────────────────────┘
                 │
    ┌────────────┴─────────────┐
    │                          │
    ▼                          ▼
┌──────────┐            ┌──────────────┐
│  前端静态  │            │   API反向代理  │
│   文件    │            │  /api/* 路径   │
└──────────┘            └───────┬────────┘
                                │
                                ▼
                    ┌──────────────────────┐
                    │   WeKnora 后端服务    │
                    │   端口: 8080          │
                    │   (Go 应用)           │
                    └───────┬───────────────┘
                            │
        ┌───────────────────┼──────────────────┐
        │                   │                  │
        ▼                   ▼                  ▼
┌──────────────┐   ┌─────────────┐   ┌──────────────┐
│  PostgreSQL  │   │    Redis    │   │  DocReader   │
│  端口: 5432   │   │  端口: 6379  │   │ 端口: 50051   │
└──────────────┘   └─────────────┘   │  (Python)    │
                                      └──────────────┘
                            │
                            ▼
                    ┌──────────────┐
                    │    MinIO     │
                    │  端口: 9000   │
                    │  (对象存储)    │
                    └──────────────┘
```

---

## 部署步骤

### 1. 准备工作

#### 1.1 创建网站目录

在宝塔面板中创建网站：

1. 登录宝塔面板
2. 点击"网站" -> "添加站点"
3. 填写域名：如 `weknora.yourdomain.com`
4. 选择 PHP 版本：纯静态（因为前端是 Vue 项目）
5. 创建 FTP 和数据库（可选）
6. 点击"提交"

假设创建的网站目录为：`/www/wwwroot/weknora.yourdomain.com`

#### 1.2 上传项目代码

通过以下方式之一上传代码：

**方式一：使用 Git（推荐）**

SSH 登录服务器，执行：

```bash
cd /www/wwwroot/weknora.yourdomain.com
# 删除默认文件
rm -rf *

# 克隆项目（如果是私有仓库，需要配置 SSH 密钥）
git clone https://github.com/Tencent/WeKnora.git .

# 或者克隆你的二开仓库
# git clone https://your-git-repo/WeKnora.git .
```

**方式二：使用宝塔文件管理器**

1. 在本地打包项目为 `weknora.zip`
2. 在宝塔面板 -> 文件 -> 上传
3. 上传到 `/www/wwwroot/weknora.yourdomain.com`
4. 解压

#### 1.3 设置目录权限

```bash
cd /www/wwwroot/weknora.yourdomain.com
chown -R www:www .
chmod -R 755 .
```

---

### 2. 安装依赖服务

#### 2.1 安装 Go 环境

在宝塔面板的软件商店搜索并安装"Go"，或手动安装：

```bash
# 下载 Go 1.24.2
cd /tmp
wget https://go.dev/dl/go1.24.2.linux-amd64.tar.gz

# 安装
rm -rf /usr/local/go
tar -C /usr/local -xzf go1.24.2.linux-amd64.tar.gz

# 配置环境变量
echo 'export PATH=$PATH:/usr/local/go/bin' >> /etc/profile
echo 'export GOPATH=/root/go' >> /etc/profile
source /etc/profile

# 验证安装
go version
```

配置 Go 代理（加速依赖下载）：

```bash
go env -w GO111MODULE=on
go env -w GOPROXY=https://goproxy.cn,direct
```

#### 2.2 安装 Python 环境

宝塔面板通常已安装 Python，检查版本：

```bash
python3 --version
```

如果版本低于 3.8，需要升级或安装：

```bash
# CentOS
yum install python38 python38-pip

# Ubuntu
apt install python3.8 python3-pip
```

安装 Poetry（Python 依赖管理工具）：

```bash
curl -sSL https://install.python-poetry.org | python3 -
export PATH="/root/.local/bin:$PATH"
echo 'export PATH="/root/.local/bin:$PATH"' >> ~/.bashrc
```

#### 2.3 安装 Node.js 环境

在宝塔面板软件商店安装"PM2管理器"，它会自动安装 Node.js。

或手动安装：

```bash
# 安装 nvm
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
source ~/.bashrc

# 安装 Node.js 18
nvm install 18
nvm use 18
node -v
npm -v
```

---

### 3. 配置数据库

#### 3.1 安装 PostgreSQL

在宝塔面板软件商店搜索并安装"PostgreSQL"（推荐 13 或更高版本）。

**注意**：如果需要使用向量搜索功能，推荐手动安装 ParadeDB。

**安装 ParadeDB（可选，支持全文搜索和向量搜索）**：

```bash
# 使用 Docker 安装 ParadeDB（推荐）
docker pull paradedb/paradedb:latest
docker run -d \
  --name weknora-postgres \
  -p 5432:5432 \
  -e POSTGRES_USER=weknora \
  -e POSTGRES_PASSWORD=your_secure_password \
  -e POSTGRES_DB=weknora \
  -v /www/server/data/postgres:/var/lib/postgresql/data \
  paradedb/paradedb:latest
```

或在宝塔面板安装的 PostgreSQL 基础上添加 pgvector 扩展。

#### 3.2 创建数据库和用户

登录 PostgreSQL：

```bash
# 如果使用宝塔面板安装的 PostgreSQL
su - postgres
psql

# 或使用 Docker 安装的
docker exec -it weknora-postgres psql -U postgres
```

创建数据库和用户：

```sql
-- 创建用户
CREATE USER weknora WITH PASSWORD 'your_secure_password';

-- 创建数据库
CREATE DATABASE weknora OWNER weknora;

-- 授权
GRANT ALL PRIVILEGES ON DATABASE weknora TO weknora;

-- 退出
\q
```

#### 3.3 初始化数据库

执行数据库初始化脚本：

```bash
cd /www/wwwroot/weknora.yourdomain.com

# 如果使用 ParadeDB
psql -h localhost -U weknora -d weknora -f migrations/paradedb/00-init-db.sql
psql -h localhost -U weknora -d weknora -f migrations/paradedb/01-migrate-to-paradedb.sql

# 如果使用普通 PostgreSQL + pgvector
psql -h localhost -U weknora -d weknora -f migrations/mysql/00-init-db.sql
```

输入密码后执行。

#### 3.4 安装 Redis

在宝塔面板软件商店搜索并安装"Redis"。

安装完成后：
1. 点击"设置" -> "配置修改"
2. 设置密码（找到 `requirepass`，设置强密码）
3. 重启 Redis

#### 3.5 安装 MinIO（对象存储）

**使用 Docker 安装 MinIO**：

```bash
docker pull minio/minio:latest
docker run -d \
  --name weknora-minio \
  -p 9000:9000 \
  -p 9001:9001 \
  -e MINIO_ROOT_USER=minioadmin \
  -e MINIO_ROOT_PASSWORD=minioadmin \
  -v /www/server/data/minio:/data \
  minio/minio:latest server /data --console-address ":9001"
```

**或使用本地存储**（跳过 MinIO 安装，在配置文件中设置 `STORAGE_TYPE=local`）。

---

### 4. 部署后端服务

#### 4.1 配置环境变量

创建 `.env` 文件：

```bash
cd /www/wwwroot/weknora.yourdomain.com
cat > .env << 'EOF'
# 数据库配置
DB_DRIVER=postgres
DB_HOST=localhost
DB_PORT=5432
DB_USER=weknora
DB_PASSWORD=your_secure_password
DB_NAME=weknora

# Redis 配置
REDIS_ADDR=localhost:6379
REDIS_PASSWORD=your_redis_password
REDIS_DB=0
REDIS_PREFIX=weknora:

# 存储配置（选择一种）
# 使用本地存储
STORAGE_TYPE=local
LOCAL_STORAGE_BASE_DIR=/www/wwwroot/weknora.yourdomain.com/data/files

# 或使用 MinIO
# STORAGE_TYPE=minio
# MINIO_ENDPOINT=localhost:9000
# MINIO_ACCESS_KEY_ID=minioadmin
# MINIO_SECRET_ACCESS_KEY=minioadmin
# MINIO_BUCKET_NAME=weknora
# MINIO_USE_SSL=false

# 应用配置
APP_PORT=8080
FRONTEND_PORT=80
GIN_MODE=release

# DocReader 服务地址
DOCREADER_ADDR=localhost:50051

# Ollama 配置（如果使用本地 LLM）
OLLAMA_BASE_URL=http://localhost:11434

# 检索引擎配置
RETRIEVE_DRIVER=postgres  # 或 elasticsearch

# 流管理器类型
STREAM_MANAGER_TYPE=memory  # 或 redis

# 知识图谱配置
ENABLE_GRAPH_RAG=false  # 是否启用知识图谱

# 租户加密密钥（32位随机字符串）
TENANT_AES_KEY=your-32-character-random-key-here

# 并发池大小
CONCURRENCY_POOL_SIZE=5

# 初始化模型配置（可选，也可以通过 Web UI 配置）
# INIT_LLM_MODEL_NAME=qwen2.5
# INIT_LLM_MODEL_BASE_URL=http://localhost:11434
# INIT_LLM_MODEL_API_KEY=

# INIT_EMBEDDING_MODEL_NAME=bge-large-zh
# INIT_EMBEDDING_MODEL_BASE_URL=http://localhost:11434
# INIT_EMBEDDING_MODEL_API_KEY=
# INIT_EMBEDDING_MODEL_DIMENSION=1024

EOF
```

**重要**：修改以上配置中的密码和密钥为你自己的安全值。

生成随机密钥：

```bash
# 生成 32 位随机密钥
openssl rand -hex 16
```

#### 4.2 创建必要的目录

```bash
mkdir -p /www/wwwroot/weknora.yourdomain.com/data/files
chown -R www:www /www/wwwroot/weknora.yourdomain.com/data
```

#### 4.3 编译后端服务

```bash
cd /www/wwwroot/weknora.yourdomain.com

# 下载 Go 依赖
go mod download

# 编译
go build -o WeKnora -ldflags="-w -s" ./cmd/server

# 设置可执行权限
chmod +x WeKnora
```

#### 4.4 使用 PM2 管理后端服务

在宝塔面板安装"PM2管理器"插件。

或手动安装 PM2：

```bash
npm install -g pm2
```

创建 PM2 配置文件：

```bash
cd /www/wwwroot/weknora.yourdomain.com
cat > ecosystem.config.js << 'EOF'
module.exports = {
  apps: [
    {
      name: 'weknora-app',
      script: './WeKnora',
      cwd: '/www/wwwroot/weknora.yourdomain.com',
      instances: 1,
      autorestart: true,
      watch: false,
      max_memory_restart: '1G',
      env: {
        NODE_ENV: 'production'
      },
      error_file: '/www/wwwroot/weknora.yourdomain.com/logs/app-error.log',
      out_file: '/www/wwwroot/weknora.yourdomain.com/logs/app-out.log',
      log_date_format: 'YYYY-MM-DD HH:mm:ss',
      merge_logs: true
    }
  ]
};
EOF

# 创建日志目录
mkdir -p logs

# 启动服务
pm2 start ecosystem.config.js

# 查看状态
pm2 status

# 查看日志
pm2 logs weknora-app

# 设置开机自启
pm2 startup
pm2 save
```

---

### 5. 部署文档解析服务

#### 5.1 安装 Python 依赖

```bash
cd /www/wwwroot/weknora.yourdomain.com/services/docreader

# 使用 Poetry 安装依赖
poetry install

# 或使用 pip
pip3 install -r requirements.txt
```

#### 5.2 配置 DocReader 服务

DocReader 服务会读取环境变量，确保 `.env` 文件中有以下配置：

```bash
# DocReader 相关配置
STORAGE_TYPE=local
MINIO_PUBLIC_ENDPOINT=http://localhost:9000
MINIO_ENDPOINT=localhost:9000
MINIO_ACCESS_KEY_ID=minioadmin
MINIO_SECRET_ACCESS_KEY=minioadmin
MINIO_BUCKET_NAME=weknora
MINIO_USE_SSL=false

# 视觉语言模型配置（用于图像识别，可选）
# VLM_MODEL_BASE_URL=http://localhost:11434
# VLM_MODEL_NAME=llava
# VLM_MODEL_API_KEY=

# Web 代理（如果需要）
# WEB_PROXY=http://proxy.example.com:8080
```

#### 5.3 启动 DocReader 服务

使用 PM2 管理 DocReader 服务：

```bash
cd /www/wwwroot/weknora.yourdomain.com

# 添加到 ecosystem.config.js
cat >> ecosystem.config.js << 'EOF'

  apps.push({
    name: 'weknora-docreader',
    script: 'poetry',
    args: 'run python src/server/server.py',
    cwd: '/www/wwwroot/weknora.yourdomain.com/services/docreader',
    instances: 1,
    autorestart: true,
    watch: false,
    max_memory_restart: '2G',
    env: {
      NODE_ENV: 'production'
    },
    error_file: '/www/wwwroot/weknora.yourdomain.com/logs/docreader-error.log',
    out_file: '/www/wwwroot/weknora.yourdomain.com/logs/docreader-out.log',
    log_date_format: 'YYYY-MM-DD HH:mm:ss',
    merge_logs: true
  });
EOF

# 重新加载配置
pm2 reload ecosystem.config.js

# 查看状态
pm2 status
```

或直接启动：

```bash
cd /www/wwwroot/weknora.yourdomain.com/services/docreader
nohup poetry run python src/server/server.py > /www/wwwroot/weknora.yourdomain.com/logs/docreader.log 2>&1 &
```

---

### 6. 部署前端

#### 6.1 构建前端项目

```bash
cd /www/wwwroot/weknora.yourdomain.com/frontend

# 安装依赖
npm install

# 构建生产版本
npm run build

# 构建完成后，dist 目录包含所有静态文件
```

#### 6.2 配置前端静态文件目录

前端构建完成后，静态文件在 `frontend/dist` 目录。

你需要将这些文件放到 Nginx 可访问的目录：

**方式一：直接使用 dist 目录**

```bash
# 创建符号链接
ln -s /www/wwwroot/weknora.yourdomain.com/frontend/dist /www/wwwroot/weknora.yourdomain.com/public
```

**方式二：复制到网站根目录**

```bash
cp -r /www/wwwroot/weknora.yourdomain.com/frontend/dist/* /www/wwwroot/weknora.yourdomain.com/public/
```

---

### 7. 配置Nginx反向代理

#### 7.1 在宝塔面板配置 Nginx

1. 打开宝塔面板 -> 网站 -> 找到你的站点（weknora.yourdomain.com）
2. 点击"设置" -> "配置文件"
3. 替换或修改为以下配置：

```nginx
server {
    listen 80;
    server_name weknora.yourdomain.com;  # 修改为你的域名
    
    # 如果配置了 SSL，添加以下行
    # listen 443 ssl http2;
    # ssl_certificate /path/to/your/cert.pem;
    # ssl_certificate_key /path/to/your/key.pem;
    
    root /www/wwwroot/weknora.yourdomain.com/frontend/dist;
    index index.html;
    
    client_max_body_size 50M;
    
    # 安全头配置
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    
    # 访问日志和错误日志
    access_log /www/wwwlogs/weknora.yourdomain.com.log;
    error_log /www/wwwlogs/weknora.yourdomain.com.error.log;
    
    # 前端静态文件
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    # API 请求代理到后端服务
    location /api/ {
        proxy_pass http://127.0.0.1:8080/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # 连接和重试配置
        proxy_connect_timeout 30s;
        proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504;
        proxy_next_upstream_tries 3;
        proxy_next_upstream_timeout 30s;
        
        # SSE 相关配置（流式响应）
        proxy_http_version 1.1;
        proxy_set_header Connection "";
        chunked_transfer_encoding off;
        proxy_buffering off;
        proxy_cache off;
        proxy_read_timeout 3600s;
        proxy_send_timeout 3600s;
    }
    
    # 错误页面
    error_page 500 502 503 504 /50x.html;
    location = /50x.html {
        root /www/wwwroot/weknora.yourdomain.com/frontend/dist;
    }
}
```

4. 点击"保存"
5. 重启 Nginx：在宝塔面板 -> 软件商店 -> Nginx -> 重启

#### 7.2 配置 SSL（可选但推荐）

1. 在宝塔面板 -> 网站 -> 设置 -> SSL
2. 选择"Let's Encrypt" 或上传你的证书
3. 申请并部署证书
4. 开启"强制HTTPS"

---

## 服务管理

### 启动所有服务

```bash
# 启动后端和 DocReader
pm2 start ecosystem.config.js

# 启动 PostgreSQL（如果使用 Docker）
docker start weknora-postgres

# 启动 Redis（宝塔面板管理）
# 在宝塔面板 -> 软件商店 -> Redis -> 启动

# 启动 MinIO（如果使用）
docker start weknora-minio

# 重启 Nginx
/etc/init.d/nginx restart
```

### 停止所有服务

```bash
# 停止后端和 DocReader
pm2 stop all

# 停止 PostgreSQL
docker stop weknora-postgres

# 停止 MinIO
docker stop weknora-minio
```

### 查看服务状态

```bash
# 查看 PM2 管理的服务
pm2 status
pm2 logs weknora-app
pm2 logs weknora-docreader

# 查看 Docker 容器
docker ps -a

# 查看 Nginx 状态
/etc/init.d/nginx status
```

### 更新代码后重新部署

```bash
cd /www/wwwroot/weknora.yourdomain.com

# 拉取最新代码
git pull

# 重新编译后端
go build -o WeKnora -ldflags="-w -s" ./cmd/server

# 重新构建前端
cd frontend
npm install
npm run build
cd ..

# 重启服务
pm2 restart weknora-app
pm2 restart weknora-docreader

# 重启 Nginx
/etc/init.d/nginx restart
```

---

## 常见问题

### 1. 后端服务无法连接数据库

**问题**：后端日志显示 `connection refused` 或 `could not connect to database`

**解决方案**：
- 检查 PostgreSQL 是否正在运行：`docker ps` 或 `systemctl status postgresql`
- 检查 `.env` 文件中的数据库配置是否正确
- 确保 PostgreSQL 监听的端口（5432）没有被防火墙阻止

```bash
# 检查端口
netstat -tlnp | grep 5432

# 测试连接
psql -h localhost -U weknora -d weknora -c "SELECT 1;"
```

### 2. 前端显示空白页面

**问题**：访问网站显示空白或 404

**解决方案**：
- 检查前端是否正确构建：`ls frontend/dist`
- 检查 Nginx 配置中的 `root` 路径是否正确
- 查看浏览器控制台的错误信息
- 检查 Nginx 错误日志：`tail -f /www/wwwlogs/weknora.yourdomain.com.error.log`

### 3. API 请求失败（502 Bad Gateway）

**问题**：前端加载正常，但 API 请求返回 502

**解决方案**：
- 检查后端服务是否正在运行：`pm2 status`
- 检查后端日志：`pm2 logs weknora-app`
- 确认后端监听的端口（8080）与 Nginx 配置一致
- 测试后端是否可访问：`curl http://localhost:8080/api/v1/health`

### 4. 文件上传失败

**问题**：上传文件时报错或超时

**解决方案**：
- 检查 DocReader 服务是否运行：`pm2 logs weknora-docreader`
- 检查存储配置（本地存储或 MinIO）
- 确认存储目录有写权限：`ls -la /www/wwwroot/weknora.yourdomain.com/data/files`
- 检查 Nginx 的 `client_max_body_size` 设置

### 5. 内存占用过高

**问题**：服务运行一段时间后内存占用很高

**解决方案**：
- 在 PM2 配置中设置 `max_memory_restart`（已设置）
- 减少 `CONCURRENCY_POOL_SIZE` 的值
- 如果使用 Redis 作为 `STREAM_MANAGER_TYPE`，确保 Redis 有足够内存
- 定期重启服务：`pm2 restart all`

### 6. 如何查看完整日志

```bash
# 后端日志
pm2 logs weknora-app --lines 100

# DocReader 日志
pm2 logs weknora-docreader --lines 100

# Nginx 访问日志
tail -f /www/wwwlogs/weknora.yourdomain.com.log

# Nginx 错误日志
tail -f /www/wwwlogs/weknora.yourdomain.com.error.log

# PostgreSQL 日志（Docker）
docker logs weknora-postgres

# Redis 日志（宝塔面板）
# 在宝塔面板 -> 软件商店 -> Redis -> 日志
```

### 7. 如何备份数据

```bash
# 备份数据库
pg_dump -h localhost -U weknora -d weknora > /www/backup/weknora_$(date +%Y%m%d).sql

# 备份上传的文件
tar -czf /www/backup/weknora_files_$(date +%Y%m%d).tar.gz /www/wwwroot/weknora.yourdomain.com/data/files

# 备份配置文件
cp /www/wwwroot/weknora.yourdomain.com/.env /www/backup/weknora_env_$(date +%Y%m%d).bak
```

### 8. 性能优化建议

1. **启用 Nginx 缓存**：对静态资源添加缓存头
2. **使用 Redis 作为流管理器**：设置 `STREAM_MANAGER_TYPE=redis`
3. **启用 CDN**：将静态资源托管到 CDN
4. **数据库优化**：定期执行 `VACUUM` 和 `ANALYZE`
5. **增加服务器资源**：如果流量大，考虑增加 CPU 和内存

---

## 总结

通过以上步骤，你已经成功在宝塔面板上部署了 WeKnora 项目。主要组件包括：

- ✅ PostgreSQL 数据库
- ✅ Redis 缓存
- ✅ MinIO 对象存储（或本地存储）
- ✅ Go 后端服务（PM2 管理）
- ✅ Python DocReader 服务（PM2 管理）
- ✅ Vue 前端（Nginx 托管）
- ✅ Nginx 反向代理

现在你可以通过 `http://weknora.yourdomain.com` 访问 WeKnora 系统了！

首次访问会自动跳转到初始化配置页面，按照提示完成模型配置即可开始使用。

如有问题，请参考[常见问题](#常见问题)或查看项目文档。

---

## 附录：快速命令参考

```bash
# 服务管理
pm2 start ecosystem.config.js     # 启动所有服务
pm2 stop all                       # 停止所有服务
pm2 restart all                    # 重启所有服务
pm2 status                         # 查看服务状态
pm2 logs                           # 查看所有日志
pm2 logs weknora-app               # 查看后端日志
pm2 logs weknora-docreader         # 查看 DocReader 日志

# Nginx 管理
/etc/init.d/nginx start            # 启动 Nginx
/etc/init.d/nginx stop             # 停止 Nginx
/etc/init.d/nginx restart          # 重启 Nginx
/etc/init.d/nginx reload           # 重载配置
nginx -t                           # 测试配置文件

# Docker 管理
docker ps                          # 查看运行中的容器
docker ps -a                       # 查看所有容器
docker start weknora-postgres      # 启动 PostgreSQL
docker stop weknora-postgres       # 停止 PostgreSQL
docker logs weknora-postgres       # 查看日志

# 数据库管理
psql -h localhost -U weknora -d weknora   # 登录数据库
pg_dump -h localhost -U weknora -d weknora > backup.sql  # 备份
psql -h localhost -U weknora -d weknora < backup.sql     # 恢复

# 项目更新
cd /www/wwwroot/weknora.yourdomain.com
git pull
go build -o WeKnora -ldflags="-w -s" ./cmd/server
cd frontend && npm run build && cd ..
pm2 restart all
```

---

**祝你部署顺利！** 🎉
